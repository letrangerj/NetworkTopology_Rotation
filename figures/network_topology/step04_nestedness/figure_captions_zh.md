# 图注 — 步骤04：嵌套性（NODF）分析
# Path: figures/network_topology/step04_nestedness/figure_captions.txt
# Generated: 2025-10-08
# Author: automated-agent (engineer)
#
# 说明：
# - 本文件为步骤04（NODF 嵌套性分析）生成图的中文图注。
# - 数值结果与运行摘要见：[`docs/phase_04/step04_nestedness_summary.txt`](docs/phase_04/step04_nestedness_summary.txt:1)
# - 可视化文件位于：[`figures/network_topology/step04_nestedness/`](figures/network_topology/step04_nestedness/:1)
#
# -----------------------------------------------------------------------------
# 文件: figures/network_topology/step04_nestedness/nodf_matrix_fg.pdf
# -----------------------------------------------------------------------------
Caption:
功能组（FG）层级嵌套性矩阵（177 个功能组 × 93 个 pyoverdine），按度数降序排列。黑色方格表示存在二元相互作用（生产或利用）；白色方格表示未观察到相互作用。
本次运行统计摘要：相互作用总数 = 2,244（矩阵填充率 = 13.6%）；NODF（bipartite 实现）= 20.37；交叉验证（vegan 实现）= 14.93。
解读方法：
  - 全局模式：按度数排序的行列可揭示专一性是否构成广泛型主体的嵌套子集。
  - 若矩阵左上角呈现密集带状并向右下逐渐稀疏，表明存在嵌套结构；若出现块状离对角结构则暗示模块性特征。
  - 若本次运行未导出每行/列的 NODF 分量（NA），可结合度数标注（如有覆盖）与可视化排序推断嵌套性的主要驱动侧。
生物学意义：
  - FG 层级 NODF ≈ 20（中等嵌套程度）表明存在共享的 pyoverdine 核心相互作用网络，同时部分功能组表现为专业化特征。
文件与使用：
  - 位置：[`figures/network_topology/step04_nestedness/nodf_matrix_fg.pdf`](figures/network_topology/step04_nestedness/nodf_matrix_fg.pdf:1)
  - 数值摘要：[`docs/phase_04/step04_nestedness_summary.txt`](docs/phase_04/step04_nestedness_summary.txt:1)
  - 程序化结果：[`results/phase_04/nestedness/nestedness_fg.rds`](results/phase_04/nestedness/nestedness_fg.rds:1)

# -----------------------------------------------------------------------------
# 文件: figures/network_topology/step04_nestedness/nodf_matrix_str.pdf
# -----------------------------------------------------------------------------
Caption:
菌株（STR）层的嵌套性矩阵（1,809 个菌株 × 93 个 pyoverdines），按度数从高到低排序。黑色方格表示二元交互；对于大型网络，图像可能展示按度数排序的前 200 个菌株以便清晰呈现结构。
本次运行摘要统计：交互总数 = 14,204（矩阵填充率 = 8.4%）；NODF（bipartite 实现）≈ 13.21；交叉验证（vegan）≈ 13.71。
如何解读：
  - 更低的全局密度与更大的网络规模通常会降低观测到的 NODF，相较于 FG 级表现出更弱的嵌套性；请关注高位度数的菌株以检验嵌套信号。
  - 若图像为前 200 的子集，请将其视为对最具连接性的菌株的可视化展示，而非完整网络的直接替代。
生物学解读：
  - STR 级 NODF ≈ 13（中等偏低，弱于 FG 级）表明菌株层面谱系更具异质性或专业化，使得专一谱系不太可能完全成为通用者的子集。
文件与使用：
  - 位置：[`figures/network_topology/step04_nestedness/nodf_matrix_str.pdf`](figures/network_topology/step04_nestedness/nodf_matrix_str.pdf:1)
  - 数值摘要：[`docs/phase_04/step04_nestedness_summary.txt`](docs/phase_04/step04_nestedness_summary.txt:1)
  - 程序化结果：[`results/phase_04/nestedness/nestedness_str.rds`](results/phase_04/nestedness/nestedness_str.rds:1)

# -----------------------------------------------------------------------------
# 文件: figures/network_topology/step04_nestedness/nodf_comparison.pdf
# -----------------------------------------------------------------------------
Caption:
比较不同网络层次总体 NODF 的条形图：功能组（FG）：NODF ≈ 20.37（bipartite），14.93（vegan）；菌株（STR）：NODF ≈ 13.21（bipartite），13.71（vegan）。
解读要点：
  - FG 级网络在本次运行中表观 NODF 高于 STR 级，這與将菌株压缩为功能组后共享谱系被放大的预期一致。
  - bipartite 与 vegan 实现间在 FG 级出现的适度差异（20.4 vs 14.9）强调了不同软件在归一化与组件报告上的细微实现差别；在稿件中建议报告两种结果或选择并记录一个规范实现。
  - 建议将该面板作为稿件或补充材料中的简明统计摘要，并配合零模型显著性检验以报告标准化效应量。
文件与使用：
  - 位置：[`figures/network_topology/step04_nestedness/nodf_comparison.pdf`](figures/network_topology/step04_nestedness/nodf_comparison.pdf:1)
  - 数值摘要：[`docs/phase_04/step04_nestedness_summary.txt`](docs/phase_04/step04_nestedness_summary.txt:1)
  - 程序化结果：[`results/phase_04/nestedness/`](results/phase_04/nestedness/:1)

# -----------------------------------------------------------------------------
# 简介：NODF（基于重叠与递减填充的嵌套性度量）
# -----------------------------------------------------------------------------
方法学简介与注释：
  - **什么是嵌套性？** 在生态网络中，嵌套性描述了一种模式，即连接较少的物种（专一者）的相互作用形成连接较多物种（通用者）相互作用的完美子集。想象一个食物网，其中专一性捕食者只吃通用性捕食者也吃的猎物——这会形成嵌套层次。在二分网络中（如植物-传粉者或宿主-寄生虫系统），嵌套性意味着专一者只与通用者的一部分伙伴相互作用。

  - **什么是 NODF？** NODF（基于重叠和递减填充的嵌套性度量）是生态二分网络中广泛使用的嵌套性定量指标。它是为了克服早期指标（如 NODF）的局限性而开发的。NODF 通过结合两个关键组件来量化层级重叠：
      (a) **递减填充**：行和列按其总相互作用数（度数）降序排列。在完美嵌套网络中，矩阵应显示从左上角到右下角填充单元格的逐渐减少。
      (b) **成对重叠**：对于每一对行（或列），NODF 测量其相互作用集合的重叠程度，并惩罚偏离完美子集关系的偏差。

  - **NODF 如何计算？** 该指标范围从 0（无嵌套性）到 100（完美嵌套性）。其工作原理为：
      1. 按度数降序排列行和列（总相互作用数）。
      2. 对于每一对行，计算其相互作用集合的重叠。
      3. 在所有成对组合中平均这些重叠，按完美嵌套下的预期重叠加权。
      4. 对列重复此过程，并结合行和列组件。
      数学上，NODF = (平均行嵌套性 + 平均列嵌套性) / 2，其中每个组件考虑了实际存在的预期重叠比例。

  - **为什么嵌套性重要？** 嵌套性具有生物学意义，因为它揭示了非随机的相互作用模式。高嵌套性表明专一者依赖于通用者伙伴的核心集合，这可能表示：
      - **生态稳定性**：通用者为专一者提供"保险"。
      - **共同进化历史**：共享相互作用可能反映共同进化压力。
      - **群落组装**：嵌套模式可能源于环境过滤或竞争层次。
      在微生物铁载体网络中，嵌套性可能表明某些 pyoverdine 是许多菌株使用的"公共物品"，而专一者具有受限谱系。

  - **如何解读 NODF 值？** NODF 值通常在 0–100 量表上报告；为便于本分析流程的比较，本实现使用原始 NODF 得分（可跨运行比较），并提供以下实用性解释区间：
      * NODF < 10  : 低嵌套性（网络呈现模块化/非重叠结构特征——相互作用被 compartmentalized）
      * NODF 10–30 : 中等嵌套性（混合的模块-嵌套体系结构——存在一些层级，同时有专业化）
      * NODF > 30  : 高嵌套性（强烈的层级包含关系和通用者→专一者排序模式——专一者是通用者的子集）
      值高于 50 的情况罕见，表示近乎完美的嵌套性。

  - **技术说明与注意事项**：不同软件包在实现 NODF 时存在细微差异（例如归一化或缺失数据处理方式）。本流程优先使用 `bipartite` 包计算主要 NODF 值（如可用），并用 `vegan` 包进行交叉验证；在最终报告中应记录所选软件包及其版本，并确定一种规范的计算方法。NODF 假设二元相互作用，在非常稀疏或非常密集的网络上可能表现不佳。为获得统计严谨性，应始终将观测 NODF 与零模型（保持度序列的随机网络）进行比较。

# -----------------------------------------------------------------------------
# 这些结果的生物学意义（简要）
# -----------------------------------------------------------------------------
  - FG 级结果（bipartite NODF ≈ 20.4；vegan ≈ 14.9）表明，在将菌株折叠为功能组后存在中等程度的嵌套性：许多功能组共享核心 pyoverdine 相互作用，而部分组为专业化。
  - STR 级结果（bipartite NODF ≈ 13.2；vegan ≈ 13.7）显示菌株层面层级重叠较弱；菌株异质性降低了专一谱系成为通用者子集的概率。
  - 实用含义：
      * 预期同时出现模块化（模块性分析识别）与嵌套重叠：模块内部可能包含嵌套子集。
      * 高度度数的 pyoverdine 与高度数的消费者是结构嵌套模式的关键枢纽，建议优先针对其进行敏感性测试（移除/扰动并重新计算指标）。
      * 需运用保度数的零模型（degree-preserving randomizations）来检验观测到的 NODF 是否显著高于仅由度序列产生的期望值；计算经验 p 值与标准化效应量（SES）以获得严格的解释。

# -----------------------------------------------------------------------------
# 建议的后续工作（简短）
# -----------------------------------------------------------------------------
  1. 导出每行与每列的 NODF 分量（row/column components），以识别嵌套性主要由代理（agent）侧或 pyov 侧驱动。
  2. 使用保持度数的零模型（试点 N=100，最终 N≥1000 的 swap 置换）计算 p 值與 SES，以评估观测 NODF 的显著性。
  3. 分别在“仅生产”与“仅利用”矩阵上计算嵌套性，以分离生产者和消费者对总嵌套性的贡献。
  4. 在已排序的嵌套矩阵上叠加一致性模块分配（[`results/phase_04/modularity/modules_fg_consensus.csv`](results/phase_04/modularity/modules_fg_consensus.csv:1)）以可视化模块与嵌套结构的相对位置。
  5. 在准备稿件图时，于 `docs/phase_04/session_info.txt` 中记录所选的 canonical NODF 方法与包版本，并将该信息包含在图注或方法部分。

# End of file.