# 图注 — 步骤03：模块性分析
# Path: figures/network_topology/step03_modularity_figures/figure_captions.txt
# Generated: 2025-10-08
# Author: automated-agent (engineer)
#
# Notes:
# - 这些说明描述了步骤03模块性分析生成的图（重复Louvain、共分配矩阵和一致性分区）。
#   它们解释了每张图所展示的内容、可视化编码的解读方式，以及脚本生成的数值输出如何使用。
# - 相关程序输出用于生成和解释这些图：
#     results/phase_04/modularity/modularity_scores.csv   (重复模组度 Q 值)
#     results/phase_04/modularity/coassignment_matrix.rds (共分配比例矩阵)
#     results/phase_04/modularity/modules_fg_consensus.csv (一致性节点 → 模块 映射)
#
# -----------------------------------------------------------------------------
# File: figures/network_topology/step03_modularity_figures/modularity_histogram.pdf
# -----------------------------------------------------------------------------
Caption:
模块度 (Q) 值的直方图，来自多次社区检测运行（Louvain 算法；试验性重复 n = 20）。每个柱表示重复运行中模组度得分的频率；该分布刻画了在随机化协议下算法目标的稳定性与变异性。
解释：
  - 中心与离散度：重复的平均模块度约为 0.412（标准差 ≈ 0.020；n = 20；最小 ≈ 0.374；最大 ≈ 0.433）。
    若分布紧凑（标准差相比均值较小）则表示分区算法在所选随机化下返回一致的分区；若分布宽则表明算法不稳定性高。
  - 一致性模块度指示：图中标注了一致性分区的模块度（虚线）。若一致性模块度接近重复均值，则一致性分区的质量与单次运行的典型解相当。
  - 实用建议：使用此直方图来 (a) 为稳定性检查选择合适的重复次数（此处 20 为试验），(b) 若标准差相对于均值较大或需要稳健的模块分配，可考虑增加重复次数（例如到 100）。
文件与使用：
  - 存放位置：figures/network_topology/step03_modularity_figures/modularity_histogram.pdf
  - 数值重复值：results/phase_04/modularity/modularity_scores.csv
  - 建议阈值：若 SD/mean > ~0.05，请考虑增加重复次数。

# -----------------------------------------------------------------------------
# File: figures/network_topology/step03_modularity_figures/coassignment_heatmap.png
# File: figures/network_topology/step03_modularity_figures/coassignment_heatmap.pdf
# -----------------------------------------------------------------------------
Caption:
共分配矩阵热图（按一致性分区排序）。每个单元格 (i, j) 报告在多少比例的重复分区中节点 i 与节点 j 被分配到同一模块（范围 0.0–1.0）。
色标：白色 ≈ 0（从未共分配），橙色 ≈ 中等共分配频率，红色 ≈ 1（始终共分配）。
读取热图的方法：
  - 块对角结构：沿对角的致密红色连续块对应在重复中经常被分在一起的节点集合——这些是共识模块的稳健核心。
  - 对角线外的着色：若不同对角块之间存在较高的着色，说明算法有时会将这些块的节点合并（边界模糊或层次结构）。
  - 块内梯度：块内部不同强度表明模块内哪些节点更核心（与大多数模块成员具有高共分配）或更边缘（共分配频率较低）。
该图的生物学意义：
  - 功能模块的稳定性：若功能组（FG）节点和/或 pyov 节点形成强且紧凑的块，说明在不同重复中保持一致的组结构；这些模块可用于生物学解释，例如共同进化的合成酶与受体、生态行会或栖息地特定的相互作用模式。
  - 边界模糊：模糊或部分共分配的节点可能表示 (i) 在多种交互情境间起桥梁作用的节点（如通用型消费者或多合成酶生产者），或 (ii) 在当前网络表征下算法分辨率的限制。建议对这些节点进行敏感性分析（移除节点后重跑或检查其生物学元数据）。
实用操作：
  - 阈值提取：若要为下游功能富集或可视化提取“核心”模块，可选择对模块核心平均共分配 > 0.8 的节点。共分配在 ~0.4–0.8 之间的节点应标记为半稳定；低于 0.4 的值表示模块归属弱或不稳定。
  - 交叉参考：使用 results/phase_04/modularity/modules_fg_consensus.csv 将节点 ID 映射到一致性模块，并使用 results/phase_04/modularity/coassignment_matrix.rds（或 CSV）计算每个节点的平均共分配得分。
文件与使用：
  - 热图文件：PNG 和 PDF 版本位于 figures/network_topology/step03_modularity_figures/
  - 共分配矩阵：results/phase_04/modularity/coassignment_matrix.rds 和 coassignment_matrix.csv
  - 一致性成员：results/phase_04/modularity/modules_fg_consensus.csv

# -----------------------------------------------------------------------------
# How these figures were produced (method summary) — short technical note
# -----------------------------------------------------------------------------
简要方法说明与如何联合解释管道输出：
  1. 输入网络：功能组（FG）节点 + PYO（pyoverdine）节点，带无向二分边（agent ↔ pyov），源自 Phase 3 的邻接/边列表。
  2. 重复次数：脚本运行了 n = 20 次随机 Louvain 复制（确定性地设置种子）。顶点顺序的小随机置换引入了复制变异以探测稳定性。
  3. 每次复制输出：每次算法返回一个分区及其模块度 Q。这些 Q 值绘制在模块度直方图中以检查重复级别的变异。
  4. 共分配矩阵：脚本计算每对节点在多少重复中被共分配；该矩阵量化了跨运行的成对分区稳定性。
  5. 一致性分区：通过对共分配矩阵构建的图进行聚类（在共分配图上运行 Louvain）得到一致性分区。该一致性分区保存在：
       results/phase_04/modularity/modules_fg_consensus.csv
     并用于对共分配热图的行/列排序。
  6. 建议后续：
     - 若模块度方差大，增加重复次数并重新评估共分配稳定性。
     - 使用每个节点的共分配得分识别稳健的模块核心与模糊节点。
     - 将 FG 与 pyov 节点表注上共识模块 ID，并绘制按共识模块着色的二分网络以进行生物学解读（例如检查哪些模块同时包含生产者与消费者、模块是否富集特定类群或栖息地）。
  7. 本次运行的关键指标：
     - 重复次数：20
     - 重复模块度 Q：均值 ≈ 0.412，SD ≈ 0.020，min ≈ 0.374，max ≈ 0.433
     - 一致性模块（来自 modules_fg_consensus.csv）：5 个模块（在 CSV 中标记为 1..5）
     - 文件位置：
         * figures/network_topology/step03_modularity_figures/modularity_histogram.pdf
         * figures/network_topology/step03_modularity_figures/coassignment_heatmap.pdf
         * results/phase_04/modularity/coassignment_matrix.rds（原始共分配矩阵）
         * results/phase_04/modularity/modules_fg_consensus.csv（节点 → 一致性模块）
         * results/phase_04/modularity/modularity_scores.csv（重复 Q 值）
#
# -----------------------------------------------------------------------------
# Usage tips for manuscript figures
# -----------------------------------------------------------------------------
  - 将模块度直方图作为补充面板以展示算法稳定性。
  - 将共分配热图作为证明一致性模块的可视化依据（在图中包括 0→1 的颜色条目）。在主图中展示按一致性模块着色的简化二分网络，并将热图放在补充材料以记录稳定性。
  - 在提出模块层面的生物学结论时（例如“模块 A 对 X 富集”），务必附上一句稳定性说明并引用共分配得分（例如“模块 A 的核心节点在 20 次重复中平均共分配 > 0.85”）。
#
# End of file.